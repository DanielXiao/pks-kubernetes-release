#!/bin/bash

set -eu -o pipefail

# Mark all mounted devices as shareable for MountPropagation feature
# https://github.com/kubernetes/kubernetes/issues/61058

<% if_link('cloud-provider') do |cloud_provider|
    if cloud_provider.p('cloud-provider.type') == 'vsphere' %>
  <% if_p('http_proxy') do |http_proxy| %>
    export http_proxy=<%= http_proxy %>
    export HTTP_PROXY=<%= http_proxy %>
  <% end %>
  <% if_p('https_proxy') do |https_proxy| %>
    export https_proxy=<%= https_proxy %>
    export HTTPS_PROXY=<%= https_proxy %>
  <% end %>
  <% if_p('no_proxy') do |no_proxy| %>
    export no_proxy=<%= no_proxy %>
    export NO_PROXY=<%= no_proxy %>
  <% end %>
<%  end
  end %>
